(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function o(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(n){if(n.ep)return;n.ep=!0;const s=o(n);fetch(n.href,s)}})();const D=e=>{for(let t=e.length-1;t>0;t--){const o=Math.floor(Math.random()*(t+1));[e[t],e[o]]=[e[o],e[t]]}return e},ne=(e,t)=>{if(e[t]!==0)return[];const o=Math.floor(t/9),r=t%9,n=new Set;for(let a=0;a<9;a++)n.add(e[o*9+a]),n.add(e[a*9+r]);const s=Math.floor(o/3)*3,l=Math.floor(r/3)*3;for(let a=s;a<s+3;a++)for(let u=l;u<l+3;u++)n.add(e[a*9+u]);const i=[];for(let a=1;a<=9;a++)n.has(a)||i.push(a);return i},he=e=>{const t=e.slice(),o=()=>{let n=-1,s=null;for(let l=0;l<81;l++)if(t[l]===0){const i=ne(t,l);if(i.length===0)return{idx:l,cand:[]};if((!s||i.length<s.length)&&(s=i,n=l,i.length===1))break}return{idx:n,cand:s}},r=()=>{const{idx:n,cand:s}=o();if(n===-1)return!0;if(s.length===0)return!1;D(s);for(const l of s){if(t[n]=l,r())return!0;t[n]=0}return!1};return r()?t:null},be=(e,t=2)=>{const o=e.slice();let r=0;const n=()=>{let l=-1,i=null;for(let a=0;a<81;a++)if(o[a]===0){const u=ne(o,a);if(u.length===0)return{idx:a,cand:[]};if((!i||u.length<i.length)&&(i=u,l=a,u.length===1))break}return{idx:l,cand:i}},s=()=>{if(r>=t)return;const{idx:l,cand:i}=n();if(l===-1){r++;return}if(i.length!==0){for(const a of i)if(o[l]=a,s(),o[l]=0,r>=t)return}};return s(),r},ye=()=>he(Array(81).fill(0)),X=e=>e.map(t=>String(t)).join(""),ve=({minClues:e=32,maxClues:t=36,symmetric:o=!0}={})=>{const r=ye();if(!r)throw new Error("Failed to generate solution");const n=r.slice(),s=Array.from({length:81},(c,f)=>f);D(s);const l=e+Math.floor(Math.random()*(t-e+1));let i=81;const a=new Set,u=[];for(const c of s){if(a.has(c))continue;if(!o){a.add(c),u.push([c]);continue}const f=80-c;a.add(c),a.add(f),u.push(c===f?[c]:[c,f])}D(u);for(const c of u){if(i<=l)break;const f=c.filter(p=>n[p]!==0).length;if(f===0||i-f<l)continue;const _=c.map(p=>n[p]);for(const p of c)n[p]=0;if(be(n,2)!==1)for(let p=0;p<c.length;p++)n[c[p]]=_[p];else i-=f}return{givens:X(n),solution:X(r)}},H="sudoku_v1",z=document.getElementById("board"),Z=document.getElementById("pad"),_e=document.getElementById("padContainer"),T=document.getElementById("boardWrap"),re=document.getElementById("newPuzzle"),oe=document.getElementById("resetPuzzle"),Ee=document.getElementById("themeToggle"),E=document.getElementById("difficultyBubble"),L=document.getElementById("resetBubble"),F=Array.from(document.querySelectorAll("[data-difficulty]")),Le=Array.from(document.querySelectorAll("[data-reset]")),B=document.getElementById("noteSwitch"),Ae=document.getElementById("eraseBtn"),O=document.getElementById("undoBtn");let h=null,m=null,d=0,g=!1,K="light",V=null,U=null,b=[],x="easy";const R={cells:[]},Ne=500,I={easy:{minClues:35,maxClues:40},medium:{minClues:30,maxClues:35},hard:{minClues:25,maxClues:30}},ke=(e,t)=>e*9+t,se=e=>[Math.floor(e/9),e%9],le=e=>1<<e-1,k=(e,t,o)=>Math.max(t,Math.min(o,e));function J(e){K=e==="dark"?"dark":"light",document.documentElement.setAttribute("data-theme",K)}function ie(){return V?.matches?"dark":(U?.matches,"light")}function $(){J(ie())}function xe(){if(!window.matchMedia)return;V=window.matchMedia("(prefers-color-scheme: dark)"),U=window.matchMedia("(prefers-color-scheme: light)");const e=t=>{t&&(t.addEventListener?t.addEventListener("change",$):t.addListener&&t.addListener($))};e(V),e(U)}function j(e){const t=I[e]?e:"easy";x=t,F.forEach(o=>{o.classList.toggle("menu__option--active",o.dataset.difficulty===t)})}function Se(){const t=F.find(r=>r.classList.contains("menu__option--active"))?.dataset.difficulty;return{...I[t]||I.easy,symmetric:Math.random()<.33}}function v(e){g=!!e,B.classList.toggle("pad__toggle--active",g),B.setAttribute("aria-checked",g?"true":"false"),_e?.classList.toggle("pad--notes-mode",g),y()}function A(e){const t=!!e;E?.classList.toggle("menu__bubble--open",t),E?.setAttribute("aria-hidden",t?"false":"true"),re?.setAttribute("aria-expanded",t?"true":"false")}function N(e){const t=!!e;L?.classList.toggle("menu__bubble--open",t),L?.setAttribute("aria-hidden",t?"false":"true"),oe?.setAttribute("aria-expanded",t?"true":"false")}function we(e){return{entries:e.entries.map(String).join(""),notes:e.notes.slice()}}function M(){const e={puzzle:h,progress:we(m),history:b};localStorage.setItem(H,JSON.stringify(e))}function Ce(){const e=localStorage.getItem(H);if(!e)return!1;try{const t=JSON.parse(e);if(!t?.puzzle?.givens||!t?.puzzle?.solution||!t?.progress)return!1;const o=Be(t.progress);return o?(h=t.puzzle,x=Me(h.difficulty),m=o,b=Array.isArray(t.history)?t.history.map(Pe).filter(Boolean):[],!0):!1}catch{return!1}}function Be(e){const t=Ie(e.entries),o=Array.isArray(e.notes)?e.notes.map(r=>Number(r)||0):null;return!t||!o||o.length!==81?null:{entries:t,notes:o}}function Ie(e){return e?Array.isArray(e)?e.length!==81?null:e.map(t=>k(Number(t)||0,0,9)):typeof e=="string"&&e.length===81?e.split("").map(t=>k(Number(t)||0,0,9)):null:null}function Me(e){return I[e]?e:"easy"}function Pe(e){if(!e||!Number.isInteger(e.idx)||e.idx<0||e.idx>=81)return null;const t=k(Number(e.prevEntry)||0,0,9),o=k(Number(e.nextEntry)||0,0,9),r=Number(e.prevNotes),n=Number(e.nextNotes);return!Number.isInteger(r)||!Number.isInteger(n)?null:{idx:e.idx,prevEntry:t,nextEntry:o,prevNotes:r,nextNotes:n}}function ze(){z.innerHTML="",R.cells=[];for(let e=0;e<9;e++)for(let t=0;t<9;t++){const o=ke(e,t),r=document.createElement("div");r.className="board__cell",r.dataset.idx=String(o),r.dataset.r=String(e),r.dataset.c=String(t);const n=document.createElement("div");n.className="board__value";const s=document.createElement("div");s.className="board__notes";for(let l=1;l<=9;l++){const i=document.createElement("div");i.className="board__note",i.dataset.n=String(l),i.textContent=String(l),s.appendChild(i)}r.appendChild(n),r.appendChild(s),z.appendChild(r),R.cells.push({idx:o,r:e,c:t,root:r,valueEl:n,noteEls:Array.from(s.querySelectorAll(".board__note"))})}Z.innerHTML="";for(let e=1;e<=9;e++){const t=document.createElement("button");t.type="button",t.className="btn btn--pad pad__button",t.dataset.n=String(e),t.textContent=String(e),t.addEventListener("click",()=>q(e)),Z.appendChild(t)}z.addEventListener("click",e=>{const t=e.target.closest(".board__cell");if(!t)return;const o=Number(t.dataset.idx);if(o===d){v(!g);return}ce(o)}),B.addEventListener("click",()=>v(!g)),B.addEventListener("keydown",e=>{(e.key==="Enter"||e.key===" ")&&(e.preventDefault(),v(!g))}),Ae.addEventListener("click",()=>ee()),O.addEventListener("click",()=>te()),re.addEventListener("click",e=>{e.stopPropagation(),N(!1);const t=E?.classList.contains("menu__bubble--open");A(!t)}),oe?.addEventListener("click",e=>{e.stopPropagation(),A(!1);const t=L?.classList.contains("menu__bubble--open");N(!t)}),Ee?.addEventListener("click",()=>{J(K==="dark"?"light":"dark")}),F.forEach(e=>{e.addEventListener("click",t=>{t.stopPropagation();const o=e.dataset.difficulty;j(o),localStorage.removeItem(H),de(),A(!1)})}),E?.addEventListener("click",e=>{e.stopPropagation()}),L?.addEventListener("click",e=>{e.stopPropagation()}),Le.forEach(e=>{e.addEventListener("click",t=>{t.stopPropagation(),N(!1),je()})}),window.addEventListener("keydown",e=>{if(["INPUT","TEXTAREA","SELECT"].includes(document.activeElement?.tagName))return;const t=e.key,o=navigator.userAgentData?navigator.userAgentData.platform==="macOS":/Mac|iPhone|iPad|iPod/.test(navigator.userAgent);if((t==="z"||t==="Z")&&!e.altKey&&!e.shiftKey&&(o?e.metaKey:e.ctrlKey)){e.preventDefault(),te();return}if(!(e.metaKey||e.ctrlKey||e.altKey)){if(t>="1"&&t<="9"){e.preventDefault(),q(Number(t));return}if(t==="Backspace"||t==="Delete"){e.preventDefault(),ee();return}if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(t)){e.preventDefault(),Ue(t);return}if(e.code==="Space"){e.preventDefault(),v(!g);return}}}),document.addEventListener("click",()=>{E?.classList.contains("menu__bubble--open")&&A(!1),L?.classList.contains("menu__bubble--open")&&N(!1)}),document.addEventListener("keydown",e=>{e.key==="Escape"&&(E?.classList.contains("menu__bubble--open")&&A(!1),L?.classList.contains("menu__bubble--open")&&N(!1))})}function Te(e){return Number(h.givens[e])||m.entries[e]||0}function ae(e){return Number(h.givens[e])!==0}function De(){const e=Array(81).fill(0);for(let t=0;t<81;t++)e[t]=Number(h.givens[t])||m.entries[t]||0;return e}function Oe(e){const t=Array.from({length:81},()=>!1);function o(r){const n=new Map;for(const s of r){const l=e[s];l&&(n.has(l)||n.set(l,[]),n.get(l).push(s))}for(const s of n.values())if(s.length>=2)for(const l of s)t[l]=!0}for(let r=0;r<9;r++)o(Array.from({length:9},(n,s)=>r*9+s));for(let r=0;r<9;r++)o(Array.from({length:9},(n,s)=>s*9+r));for(let r=0;r<3;r++)for(let n=0;n<3;n++){const s=[];for(let l=r*3;l<r*3+3;l++)for(let i=n*3;i<n*3+3;i++)s.push(l*9+i);o(s)}return t}function Ke(e){const t=Array.from({length:9},()=>new Set),o=Array.from({length:9},()=>new Set),r=Array.from({length:9},()=>new Set);for(let n=0;n<81;n++){const s=e[n];if(!s)continue;const[l,i]=se(n);t[l].add(s),o[i].add(s);const a=Math.floor(l/3)*3+Math.floor(i/3);r[a].add(s)}return{rowValues:t,colValues:o,boxValues:r}}function Ve(){for(let e=0;e<81;e++){const t=Number(h.givens[e])||m.entries[e]||0;if(t===0||t!==Number(h.solution[e]))return!1}return!0}function y(){const e=h.givens,t=m.entries,o=m.notes,r=Te(d),n=De(),s=Oe(n),{rowValues:l,colValues:i,boxValues:a}=Ke(n);if(T?.classList.toggle("board-shell--completed",Ve()),T){const u=`COMPLETED â€¢ ${x.toUpperCase()}`;T.setAttribute("data-completed-label",u)}R.cells.forEach(u=>{const{idx:c,root:f,valueEl:_,noteEls:p,r:fe,c:me}=u;f.classList.remove("board__cell--selected","board__cell--highlight","board__cell--error","board__cell--has-value","board__cell--notes-active"),_.classList.remove("board__value--given","board__value--entry"),_.textContent="",p.forEach(w=>{w.classList.remove("board__note--filled","board__note--conflict")});const Q=Number(e[c]),pe=t[c],S=Q||pe||0;if(S)f.classList.add("board__cell--has-value"),_.textContent=String(S),_.classList.add(Q?"board__value--given":"board__value--entry");else{const w=o[c]|0;if(w){const W=fe,Y=me,ge=Math.floor(W/3)*3+Math.floor(Y/3);p.forEach(P=>{const C=Number(P.dataset.n);w&le(C)&&(P.classList.add("board__note--filled"),(l[W].has(C)||i[Y].has(C)||a[ge].has(C))&&P.classList.add("board__note--conflict"))})}}!S&&g&&c===d&&f.classList.add("board__cell--notes-active"),c===d&&f.classList.add("board__cell--selected"),r!==0&&S===r&&f.classList.add("board__cell--highlight"),s[c]&&f.classList.add("board__cell--error")}),Re()}function ce(e){d=k(e,0,80),y()}function Ue(e){const[t,o]=se(d);let r=t,n=o;e==="ArrowUp"&&(r=(t+8)%9),e==="ArrowDown"&&(r=(t+1)%9),e==="ArrowLeft"&&(n=(o+8)%9),e==="ArrowRight"&&(n=(o+1)%9),d=r*9+n,y()}function q(e){if(ae(d))return;const t=m.notes[d]|0;if(g){const n=t^le(e)|0;G(d,0,n);return}G(d,e,t)}function ee(){if(ae(d))return;const t=m.entries[d]!==0?m.notes[d]|0:0;G(d,0,t)}function G(e,t,o){const r=m.entries[e],n=m.notes[e]|0;r===t&&n===o||(ue(e,t,o),b.push({idx:e,prevEntry:r,prevNotes:n,nextEntry:t,nextNotes:o}),b.length>Ne&&b.shift(),M(),y())}function ue(e,t,o){m.entries[e]=t,m.notes[e]=o}function te(){const e=b.pop();e&&(ue(e.idx,e.prevEntry,e.prevNotes),M(),y())}function Re(){O&&(O.disabled=b.length===0)}function de(){h={...ve(Se()),difficulty:x},m={entries:Array(81).fill(0),notes:Array(81).fill(0)},d=0,b=[],v(!1),M(),y()}function je(){m={entries:Array(81).fill(0),notes:Array(81).fill(0)},b=[],d=0,v(!1),M(),y()}function Ge(){xe(),J(ie()),ze(),j("easy"),Ce()?(j(x),v(!1),y()):de(),ce(0)}Ge();

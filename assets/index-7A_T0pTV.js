(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function o(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(n){if(n.ep)return;n.ep=!0;const s=o(n);fetch(n.href,s)}})();const T=e=>{for(let t=e.length-1;t>0;t--){const o=Math.floor(Math.random()*(t+1));[e[t],e[o]]=[e[o],e[t]]}return e},re=(e,t)=>{if(e[t]!==0)return[];const o=Math.floor(t/9),r=t%9,n=new Set;for(let a=0;a<9;a++)n.add(e[o*9+a]),n.add(e[a*9+r]);const s=Math.floor(o/3)*3,l=Math.floor(r/3)*3;for(let a=s;a<s+3;a++)for(let d=l;d<l+3;d++)n.add(e[a*9+d]);const i=[];for(let a=1;a<=9;a++)n.has(a)||i.push(a);return i},he=e=>{const t=e.slice(),o=()=>{let n=-1,s=null;for(let l=0;l<81;l++)if(t[l]===0){const i=re(t,l);if(i.length===0)return{idx:l,cand:[]};if((!s||i.length<s.length)&&(s=i,n=l,i.length===1))break}return{idx:n,cand:s}},r=()=>{const{idx:n,cand:s}=o();if(n===-1)return!0;if(s.length===0)return!1;T(s);for(const l of s){if(t[n]=l,r())return!0;t[n]=0}return!1};return r()?t:null},be=(e,t=2)=>{const o=e.slice();let r=0;const n=()=>{let l=-1,i=null;for(let a=0;a<81;a++)if(o[a]===0){const d=re(o,a);if(d.length===0)return{idx:a,cand:[]};if((!i||d.length<i.length)&&(i=d,l=a,d.length===1))break}return{idx:l,cand:i}},s=()=>{if(r>=t)return;const{idx:l,cand:i}=n();if(l===-1){r++;return}if(i.length!==0){for(const a of i)if(o[l]=a,s(),o[l]=0,r>=t)return}};return s(),r},ye=()=>he(Array(81).fill(0)),Z=e=>e.map(t=>String(t)).join(""),ve=({minClues:e=32,maxClues:t=36,symmetric:o=!0}={})=>{const r=ye();if(!r)throw new Error("Failed to generate solution");const n=r.slice(),s=Array.from({length:81},(c,m)=>m);T(s);const l=e+Math.floor(Math.random()*(t-e+1));let i=81;const a=new Set,d=[];for(const c of s){if(a.has(c))continue;if(!o){a.add(c),d.push([c]);continue}const m=80-c;a.add(c),a.add(m),d.push(c===m?[c]:[c,m])}T(d);for(const c of d){if(i<=l)break;const m=c.filter(p=>n[p]!==0).length;if(m===0||i-m<l)continue;const v=c.map(p=>n[p]);for(const p of c)n[p]=0;if(be(n,2)!==1)for(let p=0;p<c.length;p++)n[c[p]]=v[p];else i-=m}return{givens:Z(n),solution:Z(r)}},F="sudoku_v1",P=document.getElementById("board"),$=document.getElementById("pad"),_e=document.getElementById("padContainer"),z=document.getElementById("boardWrap"),oe=document.getElementById("newPuzzle"),se=document.getElementById("resetPuzzle"),Ee=document.getElementById("themeToggle"),_=document.getElementById("difficultyBubble"),E=document.getElementById("resetBubble"),J=Array.from(document.querySelectorAll("[data-difficulty]")),Le=Array.from(document.querySelectorAll("[data-reset]")),O=document.getElementById("noteSwitch"),Ae=document.getElementById("eraseBtn"),D=document.getElementById("undoBtn");let g=null,f=null,u=0,h=!1,V="light",K=null,U=null,b=[],S="easy";const R={cells:[]},Ne=500,B={easy:{minClues:35,maxClues:40},medium:{minClues:30,maxClues:35},hard:{minClues:25,maxClues:30}},xe=(e,t)=>e*9+t,le=e=>[Math.floor(e/9),e%9],G=e=>1<<e-1,x=(e,t,o)=>Math.max(t,Math.min(o,e));function Q(e){V=e==="dark"?"dark":"light",document.documentElement.setAttribute("data-theme",V)}function ie(){return K?.matches?"dark":(U?.matches,"light")}function q(){Q(ie())}function Se(){if(!window.matchMedia)return;K=window.matchMedia("(prefers-color-scheme: dark)"),U=window.matchMedia("(prefers-color-scheme: light)");const e=t=>{t&&(t.addEventListener?t.addEventListener("change",q):t.addListener&&t.addListener(q))};e(K),e(U)}function j(e){const t=B[e]?e:"easy";S=t,J.forEach(o=>{o.classList.toggle("menu__option--active",o.dataset.difficulty===t)})}function ke(){const t=J.find(r=>r.classList.contains("menu__option--active"))?.dataset.difficulty;return{...B[t]||B.easy,symmetric:Math.random()<.33}}function L(e){h=!!e,O.classList.toggle("pad__toggle--active",h),O.setAttribute("aria-checked",h?"true":"false"),_e?.classList.toggle("pad--notes-mode",h),y()}function A(e){const t=!!e;_?.classList.toggle("menu__bubble--open",t),_?.setAttribute("aria-hidden",t?"false":"true"),oe?.setAttribute("aria-expanded",t?"true":"false")}function N(e){const t=!!e;E?.classList.toggle("menu__bubble--open",t),E?.setAttribute("aria-hidden",t?"false":"true"),se?.setAttribute("aria-expanded",t?"true":"false")}function we(e){return{entries:e.entries.map(String).join(""),notes:e.notes.slice()}}function I(){const e={puzzle:g,progress:we(f),history:b};localStorage.setItem(F,JSON.stringify(e))}function Ce(){const e=localStorage.getItem(F);if(!e)return!1;try{const t=JSON.parse(e);if(!t?.puzzle?.givens||!t?.puzzle?.solution||!t?.progress)return!1;const o=Be(t.progress);return o?(g=t.puzzle,S=Me(g.difficulty),f=o,b=Array.isArray(t.history)?t.history.map(Pe).filter(Boolean):[],!0):!1}catch{return!1}}function Be(e){const t=Ie(e.entries),o=Array.isArray(e.notes)?e.notes.map(r=>Number(r)||0):null;return!t||!o||o.length!==81?null:{entries:t,notes:o}}function Ie(e){return e?Array.isArray(e)?e.length!==81?null:e.map(t=>x(Number(t)||0,0,9)):typeof e=="string"&&e.length===81?e.split("").map(t=>x(Number(t)||0,0,9)):null:null}function Me(e){return B[e]?e:"easy"}function Pe(e){if(!e||!Number.isInteger(e.idx)||e.idx<0||e.idx>=81)return null;const t=x(Number(e.prevEntry)||0,0,9),o=x(Number(e.nextEntry)||0,0,9),r=Number(e.prevNotes),n=Number(e.nextNotes);return!Number.isInteger(r)||!Number.isInteger(n)?null:{idx:e.idx,prevEntry:t,nextEntry:o,prevNotes:r,nextNotes:n}}function ze(){P.innerHTML="",R.cells=[];for(let e=0;e<9;e++)for(let t=0;t<9;t++){const o=xe(e,t),r=document.createElement("div");r.className="board__cell",r.dataset.idx=String(o),r.dataset.r=String(e),r.dataset.c=String(t);const n=document.createElement("div");n.className="board__value";const s=document.createElement("div");s.className="board__notes";for(let l=1;l<=9;l++){const i=document.createElement("div");i.className="board__note",i.dataset.n=String(l),i.textContent=String(l),s.appendChild(i)}r.appendChild(n),r.appendChild(s),P.appendChild(r),R.cells.push({idx:o,r:e,c:t,root:r,valueEl:n,noteEls:Array.from(s.querySelectorAll(".board__note"))})}$.innerHTML="";for(let e=1;e<=9;e++){const t=document.createElement("button");t.type="button",t.className="btn btn--pad pad__button",t.dataset.n=String(e),t.textContent=String(e),t.addEventListener("click",()=>ee(e)),$.appendChild(t)}P.addEventListener("click",e=>{const t=e.target.closest(".board__cell");if(!t)return;const o=Number(t.dataset.idx);if(o===u){L(!h);return}ce(o)}),O.addEventListener("click",()=>L(!h)),Ae.addEventListener("click",()=>te()),D.addEventListener("click",()=>ne()),oe.addEventListener("click",e=>{e.stopPropagation(),N(!1);const t=_?.classList.contains("menu__bubble--open");A(!t)}),se?.addEventListener("click",e=>{e.stopPropagation(),A(!1);const t=E?.classList.contains("menu__bubble--open");N(!t)}),Ee?.addEventListener("click",()=>{Q(V==="dark"?"light":"dark")}),J.forEach(e=>{e.addEventListener("click",t=>{t.stopPropagation();const o=e.dataset.difficulty;j(o),localStorage.removeItem(F),de(),A(!1)})}),_?.addEventListener("click",e=>{e.stopPropagation()}),E?.addEventListener("click",e=>{e.stopPropagation()}),Le.forEach(e=>{e.addEventListener("click",t=>{t.stopPropagation(),N(!1),Ge()})}),window.addEventListener("keydown",e=>{if(["INPUT","TEXTAREA","SELECT"].includes(document.activeElement?.tagName))return;const t=e.key,o=navigator.userAgentData?navigator.userAgentData.platform==="macOS":/Mac|iPhone|iPad|iPod/.test(navigator.userAgent);if((t==="z"||t==="Z")&&!e.altKey&&!e.shiftKey&&(o?e.metaKey:e.ctrlKey)){e.preventDefault(),ne();return}if(!(e.metaKey||e.ctrlKey||e.altKey)){if(t>="1"&&t<="9"){e.preventDefault(),ee(Number(t));return}if(t==="Backspace"||t==="Delete"){e.preventDefault(),te();return}if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(t)){e.preventDefault(),Ue(t);return}if(e.code==="Space"){e.preventDefault(),L(!h);return}}}),document.addEventListener("click",()=>{_?.classList.contains("menu__bubble--open")&&A(!1),E?.classList.contains("menu__bubble--open")&&N(!1)}),document.addEventListener("keydown",e=>{e.key==="Escape"&&(_?.classList.contains("menu__bubble--open")&&A(!1),E?.classList.contains("menu__bubble--open")&&N(!1))})}function Te(e){return Number(g.givens[e])||f.entries[e]||0}function ae(e){return Number(g.givens[e])!==0}function Oe(){const e=Array(81).fill(0);for(let t=0;t<81;t++)e[t]=Number(g.givens[t])||f.entries[t]||0;return e}function De(e){const t=Array.from({length:81},()=>!1);function o(r){const n=new Map;for(const s of r){const l=e[s];l&&(n.has(l)||n.set(l,[]),n.get(l).push(s))}for(const s of n.values())if(s.length>=2)for(const l of s)t[l]=!0}for(let r=0;r<9;r++)o(Array.from({length:9},(n,s)=>r*9+s));for(let r=0;r<9;r++)o(Array.from({length:9},(n,s)=>s*9+r));for(let r=0;r<3;r++)for(let n=0;n<3;n++){const s=[];for(let l=r*3;l<r*3+3;l++)for(let i=n*3;i<n*3+3;i++)s.push(l*9+i);o(s)}return t}function Ve(e){const t=Array.from({length:9},()=>new Set),o=Array.from({length:9},()=>new Set),r=Array.from({length:9},()=>new Set);for(let n=0;n<81;n++){const s=e[n];if(!s)continue;const[l,i]=le(n);t[l].add(s),o[i].add(s);const a=Math.floor(l/3)*3+Math.floor(i/3);r[a].add(s)}return{rowValues:t,colValues:o,boxValues:r}}function Ke(){for(let e=0;e<81;e++){const t=Number(g.givens[e])||f.entries[e]||0;if(t===0||t!==Number(g.solution[e]))return!1}return!0}function y(){const e=g.givens,t=f.entries,o=f.notes,r=Te(u),n=Oe(),s=De(n),{rowValues:l,colValues:i,boxValues:a}=Ve(n);if(z?.classList.toggle("board-shell--completed",Ke()),z){const d=`COMPLETED â€¢ ${S.toUpperCase()}`;z.setAttribute("data-completed-label",d)}R.cells.forEach(d=>{const{idx:c,root:m,valueEl:v,noteEls:p,r:fe,c:me}=d;m.classList.remove("board__cell--selected","board__cell--highlight","board__cell--error","board__cell--has-value","board__cell--notes-active"),v.classList.remove("board__value--given","board__value--entry"),v.textContent="",p.forEach(w=>{w.classList.remove("board__note--filled","board__note--conflict")});const W=Number(e[c]),pe=t[c],k=W||pe||0;if(k)m.classList.add("board__cell--has-value"),v.textContent=String(k),v.classList.add(W?"board__value--given":"board__value--entry");else{const w=o[c]|0;if(w){const Y=fe,X=me,ge=Math.floor(Y/3)*3+Math.floor(X/3);p.forEach(M=>{const C=Number(M.dataset.n);w&G(C)&&(M.classList.add("board__note--filled"),(l[Y].has(C)||i[X].has(C)||a[ge].has(C))&&M.classList.add("board__note--conflict"))})}}!k&&h&&c===u&&m.classList.add("board__cell--notes-active"),c===u&&m.classList.add("board__cell--selected"),r!==0&&k===r&&m.classList.add("board__cell--highlight"),s[c]&&m.classList.add("board__cell--error")}),Re()}function ce(e){u=x(e,0,80),y()}function Ue(e){const[t,o]=le(u);let r=t,n=o;e==="ArrowUp"&&(r=(t+8)%9),e==="ArrowDown"&&(r=(t+1)%9),e==="ArrowLeft"&&(n=(o+8)%9),e==="ArrowRight"&&(n=(o+1)%9),u=r*9+n,y()}function ee(e){if(ae(u))return;const t=f.notes[u]|0;if(h){const s=f.entries[u]!==0?t|G(e):t^G(e);H(u,0,s);return}H(u,e,t)}function te(){if(ae(u))return;const t=f.entries[u]!==0?f.notes[u]|0:0;H(u,0,t)}function H(e,t,o){const r=f.entries[e],n=f.notes[e]|0;r===t&&n===o||(ue(e,t,o),b.push({idx:e,prevEntry:r,prevNotes:n,nextEntry:t,nextNotes:o}),b.length>Ne&&b.shift(),I(),y())}function ue(e,t,o){f.entries[e]=t,f.notes[e]=o}function ne(){const e=b.pop();e&&(ue(e.idx,e.prevEntry,e.prevNotes),I(),y())}function Re(){D&&(D.disabled=b.length===0)}function de(){g={...ve(ke()),difficulty:S},f={entries:Array(81).fill(0),notes:Array(81).fill(0)},u=0,b=[],L(!1),I(),y()}function Ge(){f={entries:Array(81).fill(0),notes:Array(81).fill(0)},b=[],u=0,L(!1),I(),y()}function je(){Se(),Q(ie()),ze(),j("easy"),Ce()?(j(S),L(!1),y()):de(),ce(0)}je();

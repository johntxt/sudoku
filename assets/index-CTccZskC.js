(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function o(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(n){if(n.ep)return;n.ep=!0;const s=o(n);fetch(n.href,s)}})();const D=e=>{for(let t=e.length-1;t>0;t--){const o=Math.floor(Math.random()*(t+1));[e[t],e[o]]=[e[o],e[t]]}return e},ae=(e,t)=>{if(e[t]!==0)return[];const o=Math.floor(t/9),r=t%9,n=new Set;for(let a=0;a<9;a++)n.add(e[o*9+a]),n.add(e[a*9+r]);const s=Math.floor(o/3)*3,l=Math.floor(r/3)*3;for(let a=s;a<s+3;a++)for(let d=l;d<l+3;d++)n.add(e[a*9+d]);const i=[];for(let a=1;a<=9;a++)n.has(a)||i.push(a);return i},_e=e=>{const t=e.slice(),o=()=>{let n=-1,s=null;for(let l=0;l<81;l++)if(t[l]===0){const i=ae(t,l);if(i.length===0)return{idx:l,cand:[]};if((!s||i.length<s.length)&&(s=i,n=l,i.length===1))break}return{idx:n,cand:s}},r=()=>{const{idx:n,cand:s}=o();if(n===-1)return!0;if(s.length===0)return!1;D(s);for(const l of s){if(t[n]=l,r())return!0;t[n]=0}return!1};return r()?t:null},Ee=(e,t=2)=>{const o=e.slice();let r=0;const n=()=>{let l=-1,i=null;for(let a=0;a<81;a++)if(o[a]===0){const d=ae(o,a);if(d.length===0)return{idx:a,cand:[]};if((!i||d.length<i.length)&&(i=d,l=a,d.length===1))break}return{idx:l,cand:i}},s=()=>{if(r>=t)return;const{idx:l,cand:i}=n();if(l===-1){r++;return}if(i.length!==0){for(const a of i)if(o[l]=a,s(),o[l]=0,r>=t)return}};return s(),r},Le=()=>_e(Array(81).fill(0)),te=e=>e.map(t=>String(t)).join(""),Ae=({minClues:e=32,maxClues:t=36,symmetric:o=!0}={})=>{const r=Le();if(!r)throw new Error("Failed to generate solution");const n=r.slice(),s=Array.from({length:81},(c,m)=>m);D(s);const l=e+Math.floor(Math.random()*(t-e+1));let i=81;const a=new Set,d=[];for(const c of s){if(a.has(c))continue;if(!o){a.add(c),d.push([c]);continue}const m=80-c;a.add(c),a.add(m),d.push(c===m?[c]:[c,m])}D(d);for(const c of d){if(i<=l)break;const m=c.filter(p=>n[p]!==0).length;if(m===0||i-m<l)continue;const _=c.map(p=>n[p]);for(const p of c)n[p]=0;if(Ee(n,2)!==1)for(let p=0;p<c.length;p++)n[c[p]]=_[p];else i-=m}return{givens:te(n),solution:te(r)}},Q="sudoku_v1",z=document.getElementById("board"),ne=document.getElementById("pad"),Ne=document.getElementById("padContainer"),T=document.getElementById("boardWrap"),ce=document.getElementById("newPuzzle"),ue=document.getElementById("resetPuzzle"),xe=document.getElementById("themeToggle"),E=document.getElementById("difficultyBubble"),L=document.getElementById("resetBubble"),W=Array.from(document.querySelectorAll("[data-difficulty]")),ke=Array.from(document.querySelectorAll("[data-reset]")),K=document.getElementById("noteSwitch"),Be=document.getElementById("eraseBtn"),V=document.getElementById("undoBtn"),R=document.getElementById("redoBtn");let h=null,f=null,u=0,b=!1,U="light",H=null,G=null,g=[],v=[],B="easy";const j={cells:[]},Se=500,M={easy:{minClues:35,maxClues:40},medium:{minClues:30,maxClues:35},hard:{minClues:25,maxClues:30}},we=(e,t)=>e*9+t,de=e=>[Math.floor(e/9),e%9],F=e=>1<<e-1,k=(e,t,o)=>Math.max(t,Math.min(o,e));function X(e){U=e==="dark"?"dark":"light",document.documentElement.setAttribute("data-theme",U)}function fe(){return H?.matches?"dark":(G?.matches,"light")}function re(){X(fe())}function Ce(){if(!window.matchMedia)return;H=window.matchMedia("(prefers-color-scheme: dark)"),G=window.matchMedia("(prefers-color-scheme: light)");const e=t=>{t&&(t.addEventListener?t.addEventListener("change",re):t.addListener&&t.addListener(re))};e(H),e(G)}function Y(e){const t=M[e]?e:"easy";B=t,W.forEach(o=>{o.classList.toggle("menu__option--active",o.dataset.difficulty===t)})}function Ie(){const t=W.find(r=>r.classList.contains("menu__option--active"))?.dataset.difficulty;return{...M[t]||M.easy,symmetric:Math.random()<.33}}function A(e){b=!!e,K.classList.toggle("pad__toggle--active",b),K.setAttribute("aria-checked",b?"true":"false"),Ne?.classList.toggle("pad--notes-mode",b),y()}function N(e){const t=!!e;E?.classList.toggle("menu__bubble--open",t),E?.setAttribute("aria-hidden",t?"false":"true"),ce?.setAttribute("aria-expanded",t?"true":"false")}function x(e){const t=!!e;L?.classList.toggle("menu__bubble--open",t),L?.setAttribute("aria-hidden",t?"false":"true"),ue?.setAttribute("aria-expanded",t?"true":"false")}function Me(e){return{entries:e.entries.map(String).join(""),notes:e.notes.slice()}}function S(){const e={puzzle:h,progress:Me(f),history:g,redoHistory:v};localStorage.setItem(Q,JSON.stringify(e))}function Pe(){const e=localStorage.getItem(Q);if(!e)return!1;try{const t=JSON.parse(e);if(!t?.puzzle?.givens||!t?.puzzle?.solution||!t?.progress)return!1;const o=ze(t.progress);return o?(h=t.puzzle,B=Oe(h.difficulty),f=o,g=Array.isArray(t.history)?t.history.map(oe).filter(Boolean):[],v=Array.isArray(t.redoHistory)?t.redoHistory.map(oe).filter(Boolean):[],!0):!1}catch{return!1}}function ze(e){const t=Te(e.entries),o=Array.isArray(e.notes)?e.notes.map(r=>Number(r)||0):null;return!t||!o||o.length!==81?null:{entries:t,notes:o}}function Te(e){return e?Array.isArray(e)?e.length!==81?null:e.map(t=>k(Number(t)||0,0,9)):typeof e=="string"&&e.length===81?e.split("").map(t=>k(Number(t)||0,0,9)):null:null}function Oe(e){return M[e]?e:"easy"}function oe(e){if(!e||!Number.isInteger(e.idx)||e.idx<0||e.idx>=81)return null;const t=k(Number(e.prevEntry)||0,0,9),o=k(Number(e.nextEntry)||0,0,9),r=Number(e.prevNotes),n=Number(e.nextNotes);return!Number.isInteger(r)||!Number.isInteger(n)?null:{idx:e.idx,prevEntry:t,nextEntry:o,prevNotes:r,nextNotes:n}}function De(){z.innerHTML="",j.cells=[];for(let e=0;e<9;e++)for(let t=0;t<9;t++){const o=we(e,t),r=document.createElement("div");r.className="board__cell",r.dataset.idx=String(o),r.dataset.r=String(e),r.dataset.c=String(t);const n=document.createElement("div");n.className="board__value";const s=document.createElement("div");s.className="board__notes";for(let l=1;l<=9;l++){const i=document.createElement("div");i.className="board__note",i.dataset.n=String(l),i.textContent=String(l),s.appendChild(i)}r.appendChild(n),r.appendChild(s),z.appendChild(r),j.cells.push({idx:o,r:e,c:t,root:r,valueEl:n,noteEls:Array.from(s.querySelectorAll(".board__note"))})}ne.innerHTML="";for(let e=1;e<=9;e++){const t=document.createElement("button");t.type="button",t.className="btn btn--pad pad__button",t.dataset.n=String(e),t.textContent=String(e),t.addEventListener("click",()=>se(e)),ne.appendChild(t)}z.addEventListener("click",e=>{const t=e.target.closest(".board__cell");if(!t)return;const o=Number(t.dataset.idx);if(o===u){A(!b);return}pe(o)}),K.addEventListener("click",()=>A(!b)),Be.addEventListener("click",()=>le()),V.addEventListener("click",()=>ie()),R?.addEventListener("click",()=>O()),ce.addEventListener("click",e=>{e.stopPropagation(),x(!1);const t=E?.classList.contains("menu__bubble--open");N(!t)}),ue?.addEventListener("click",e=>{e.stopPropagation(),N(!1);const t=L?.classList.contains("menu__bubble--open");x(!t)}),xe?.addEventListener("click",()=>{X(U==="dark"?"light":"dark")}),W.forEach(e=>{e.addEventListener("click",t=>{t.stopPropagation();const o=e.dataset.difficulty;Y(o),localStorage.removeItem(Q),ge(),N(!1)})}),E?.addEventListener("click",e=>{e.stopPropagation()}),L?.addEventListener("click",e=>{e.stopPropagation()}),ke.forEach(e=>{e.addEventListener("click",t=>{t.stopPropagation(),x(!1),Fe()})}),window.addEventListener("keydown",e=>{if(["INPUT","TEXTAREA","SELECT"].includes(document.activeElement?.tagName))return;const t=e.key,o=navigator.userAgentData?navigator.userAgentData.platform==="macOS":/Mac|iPhone|iPad|iPod/.test(navigator.userAgent),r=t==="z"||t==="Z",n=t==="y"||t==="Y";if(r&&!e.altKey&&(o?e.metaKey:e.ctrlKey)){e.preventDefault(),e.shiftKey?O():ie();return}if(n&&!e.altKey&&!e.shiftKey&&!o&&e.ctrlKey){e.preventDefault(),O();return}if(!(e.metaKey||e.ctrlKey||e.altKey)){if(t>="1"&&t<="9"){e.preventDefault(),se(Number(t));return}if(t==="Backspace"||t==="Delete"){e.preventDefault(),le();return}if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(t)){e.preventDefault(),Ge(t);return}if(e.code==="Space"){e.preventDefault(),A(!b);return}}}),document.addEventListener("click",()=>{E?.classList.contains("menu__bubble--open")&&N(!1),L?.classList.contains("menu__bubble--open")&&x(!1)}),document.addEventListener("keydown",e=>{e.key==="Escape"&&(E?.classList.contains("menu__bubble--open")&&N(!1),L?.classList.contains("menu__bubble--open")&&x(!1))})}function Ke(e){return Number(h.givens[e])||f.entries[e]||0}function me(e){return Number(h.givens[e])!==0}function Ve(){const e=Array(81).fill(0);for(let t=0;t<81;t++)e[t]=Number(h.givens[t])||f.entries[t]||0;return e}function Re(e){const t=Array.from({length:81},()=>!1);function o(r){const n=new Map;for(const s of r){const l=e[s];l&&(n.has(l)||n.set(l,[]),n.get(l).push(s))}for(const s of n.values())if(s.length>=2)for(const l of s)t[l]=!0}for(let r=0;r<9;r++)o(Array.from({length:9},(n,s)=>r*9+s));for(let r=0;r<9;r++)o(Array.from({length:9},(n,s)=>s*9+r));for(let r=0;r<3;r++)for(let n=0;n<3;n++){const s=[];for(let l=r*3;l<r*3+3;l++)for(let i=n*3;i<n*3+3;i++)s.push(l*9+i);o(s)}return t}function Ue(e){const t=Array.from({length:9},()=>new Set),o=Array.from({length:9},()=>new Set),r=Array.from({length:9},()=>new Set);for(let n=0;n<81;n++){const s=e[n];if(!s)continue;const[l,i]=de(n);t[l].add(s),o[i].add(s);const a=Math.floor(l/3)*3+Math.floor(i/3);r[a].add(s)}return{rowValues:t,colValues:o,boxValues:r}}function He(){for(let e=0;e<81;e++){const t=Number(h.givens[e])||f.entries[e]||0;if(t===0||t!==Number(h.solution[e]))return!1}return!0}function y(){const e=h.givens,t=f.entries,o=f.notes,r=Ke(u),n=Ve(),s=Re(n),{rowValues:l,colValues:i,boxValues:a}=Ue(n);if(T?.classList.toggle("board-shell--completed",He()),T){const d=`COMPLETED â€¢ ${B.toUpperCase()}`;T.setAttribute("data-completed-label",d)}j.cells.forEach(d=>{const{idx:c,root:m,valueEl:_,noteEls:p,r:he,c:be}=d;m.classList.remove("board__cell--selected","board__cell--highlight","board__cell--error","board__cell--has-value","board__cell--notes-active"),_.classList.remove("board__value--given","board__value--entry"),_.textContent="",p.forEach(C=>{C.classList.remove("board__note--filled","board__note--conflict")});const $=Number(e[c]),ye=t[c],w=$||ye||0;if(w)m.classList.add("board__cell--has-value"),_.textContent=String(w),_.classList.add($?"board__value--given":"board__value--entry");else{const C=o[c]|0;if(C){const q=he,ee=be,ve=Math.floor(q/3)*3+Math.floor(ee/3);p.forEach(P=>{const I=Number(P.dataset.n);C&F(I)&&(P.classList.add("board__note--filled"),(l[q].has(I)||i[ee].has(I)||a[ve].has(I))&&P.classList.add("board__note--conflict"))})}}!w&&b&&c===u&&m.classList.add("board__cell--notes-active"),c===u&&m.classList.add("board__cell--selected"),r!==0&&w===r&&m.classList.add("board__cell--highlight"),s[c]&&m.classList.add("board__cell--error")}),je()}function pe(e){u=k(e,0,80),y()}function Ge(e){const[t,o]=de(u);let r=t,n=o;e==="ArrowUp"&&(r=(t+8)%9),e==="ArrowDown"&&(r=(t+1)%9),e==="ArrowLeft"&&(n=(o+8)%9),e==="ArrowRight"&&(n=(o+1)%9),u=r*9+n,y()}function se(e){if(me(u))return;const t=f.notes[u]|0;if(b){const s=f.entries[u]!==0?t|F(e):t^F(e);J(u,0,s);return}J(u,e,t)}function le(){if(me(u))return;const t=f.entries[u]!==0?f.notes[u]|0:0;J(u,0,t)}function J(e,t,o){const r=f.entries[e],n=f.notes[e]|0;r===t&&n===o||(Z(e,t,o),g.push({idx:e,prevEntry:r,prevNotes:n,nextEntry:t,nextNotes:o}),v=[],g.length>Se&&g.shift(),S(),y())}function Z(e,t,o){f.entries[e]=t,f.notes[e]=o}function ie(){const e=g.pop();e&&(Z(e.idx,e.prevEntry,e.prevNotes),v.push(e),S(),y())}function O(){const e=v.pop();e&&(Z(e.idx,e.nextEntry,e.nextNotes),g.push(e),S(),y())}function je(){V&&(V.disabled=g.length===0),R&&(R.disabled=v.length===0)}function ge(){h={...Ae(Ie()),difficulty:B},f={entries:Array(81).fill(0),notes:Array(81).fill(0)},u=0,g=[],v=[],A(!1),S(),y()}function Fe(){f={entries:Array(81).fill(0),notes:Array(81).fill(0)},g=[],v=[],u=0,A(!1),S(),y()}function Ye(){Ce(),X(fe()),De(),Y("easy"),Pe()?(Y(B),A(!1),y()):ge(),pe(0)}Ye();

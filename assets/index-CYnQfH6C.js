(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function r(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(n){if(n.ep)return;n.ep=!0;const s=r(n);fetch(n.href,s)}})();const ke="modulepreload",Ne=function(e){return"/sudoku/"+e},ie={},Se=function(t,r,o){let n=Promise.resolve();if(r&&r.length>0){let d=function(u){return Promise.all(u.map(c=>Promise.resolve(c).then(h=>({status:"fulfilled",value:h}),h=>({status:"rejected",reason:h}))))};var i=d;document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),a=l?.nonce||l?.getAttribute("nonce");n=d(r.map(u=>{if(u=Ne(u),u in ie)return;ie[u]=!0;const c=u.endsWith(".css"),h=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${h}`))return;const f=document.createElement("link");if(f.rel=c?"stylesheet":ke,c||(f.as="script"),f.crossOrigin="",f.href=u,a&&f.setAttribute("nonce",a),document.head.appendChild(f),c)return new Promise((D,R)=>{f.addEventListener("load",D),f.addEventListener("error",()=>R(new Error(`Unable to preload CSS for ${u}`)))})}))}function s(l){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=l,window.dispatchEvent(a),!a.defaultPrevented)throw l}return n.then(l=>{for(const a of l||[])a.status==="rejected"&&s(a.reason);return t().catch(s)})};function xe(e={}){const{immediate:t=!1,onNeedRefresh:r,onOfflineReady:o,onRegistered:n,onRegisteredSW:s,onRegisterError:i}=e;let l,a;const d=async(c=!0)=>{await a};async function u(){if("serviceWorker"in navigator){if(l=await Se(async()=>{const{Workbox:c}=await import("./workbox-window.prod.es5-BIl4cyR9.js");return{Workbox:c}},[]).then(({Workbox:c})=>new c("/sudoku/sw.js",{scope:"/sudoku/",type:"classic"})).catch(c=>{i?.(c)}),!l)return;l.addEventListener("activated",c=>{(c.isUpdate||c.isExternal)&&window.location.reload()}),l.addEventListener("installed",c=>{c.isUpdate||o?.()}),l.register({immediate:t}).then(c=>{s?s("/sudoku/sw.js",c):n?.(c)}).catch(c=>{i?.(c)})}}return a=u(),d}const W=e=>{for(let t=e.length-1;t>0;t--){const r=Math.floor(Math.random()*(t+1));[e[t],e[r]]=[e[r],e[t]]}return e},he=(e,t)=>{if(e[t]!==0)return[];const r=Math.floor(t/9),o=t%9,n=new Set;for(let a=0;a<9;a++)n.add(e[r*9+a]),n.add(e[a*9+o]);const s=Math.floor(r/3)*3,i=Math.floor(o/3)*3;for(let a=s;a<s+3;a++)for(let d=i;d<i+3;d++)n.add(e[a*9+d]);const l=[];for(let a=1;a<=9;a++)n.has(a)||l.push(a);return l},Be=e=>{const t=e.slice(),r=()=>{let n=-1,s=null;for(let i=0;i<81;i++)if(t[i]===0){const l=he(t,i);if(l.length===0)return{idx:i,cand:[]};if((!s||l.length<s.length)&&(s=l,n=i,l.length===1))break}return{idx:n,cand:s}},o=()=>{const{idx:n,cand:s}=r();if(n===-1)return!0;if(s.length===0)return!1;W(s);for(const i of s){if(t[n]=i,o())return!0;t[n]=0}return!1};return o()?t:null},Ce=(e,t=2)=>{const r=e.slice();let o=0;const n=()=>{let i=-1,l=null;for(let a=0;a<81;a++)if(r[a]===0){const d=he(r,a);if(d.length===0)return{idx:a,cand:[]};if((!l||d.length<l.length)&&(l=d,i=a,d.length===1))break}return{idx:i,cand:l}},s=()=>{if(o>=t)return;const{idx:i,cand:l}=n();if(i===-1){o++;return}if(l.length!==0){for(const a of l)if(r[i]=a,s(),r[i]=0,o>=t)return}};return s(),o},Pe=()=>Be(Array(81).fill(0)),le=e=>e.map(t=>String(t)).join(""),Ie=({minClues:e=32,maxClues:t=36,symmetric:r=!0}={})=>{const o=Pe();if(!o)throw new Error("Failed to generate solution");const n=o.slice(),s=Array.from({length:81},(u,c)=>c);W(s);const i=e+Math.floor(Math.random()*(t-e+1));let l=81;const a=new Set,d=[];for(const u of s){if(a.has(u))continue;if(!r){a.add(u),d.push([u]);continue}const c=80-u;a.add(u),a.add(c),d.push(u===c?[u]:[u,c])}W(d);for(const u of d){if(l<=i)break;const c=u.filter(f=>n[f]!==0).length;if(c===0||l-c<i)continue;const h=u.map(f=>n[f]);for(const f of u)n[f]=0;if(Ce(n,2)!==1)for(let f=0;f<u.length;f++)n[u[f]]=h[f];else l-=c}return{givens:le(n),solution:le(o)}},Z="sudoku_v1",V=document.getElementById("board"),ae=document.getElementById("pad"),Me=document.getElementById("padContainer"),U=document.getElementById("boardWrap"),ge=document.getElementById("newPuzzle"),be=document.getElementById("resetPuzzle"),ze=document.getElementById("themeToggle"),O=document.getElementById("installBtn"),L=document.getElementById("difficultyBubble"),w=document.getElementById("resetBubble"),ee=Array.from(document.querySelectorAll("[data-difficulty]")),Oe=Array.from(document.querySelectorAll("[data-reset]")),H=document.getElementById("noteSwitch"),Te=document.getElementById("eraseBtn"),G=document.getElementById("undoBtn"),$=document.getElementById("redoBtn"),ce=document.querySelector("meta[name='theme-color']");let b=null,p=null,m=0,y=!1,z="light",q=null,F=null,g=[],E=[],B="easy",_=null;const Q={cells:[]},De=500,T={easy:{minClues:35,maxClues:40},medium:{minClues:30,maxClues:35},hard:{minClues:25,maxClues:30}},Re=(e,t)=>e*9+t,ye=e=>[Math.floor(e/9),e%9],Y=e=>1<<e-1,x=(e,t,r)=>Math.max(t,Math.min(r,e));function te(e){z=e==="dark"?"dark":"light",document.documentElement.setAttribute("data-theme",z),ce&&ce.setAttribute("content",z==="dark"?"#2e2e2e":"#f2f2f2")}function ve(){return q?.matches?"dark":(F?.matches,"light")}function ue(){te(ve())}function Ke(){if(!window.matchMedia)return;q=window.matchMedia("(prefers-color-scheme: dark)"),F=window.matchMedia("(prefers-color-scheme: light)");const e=t=>{t&&(t.addEventListener?t.addEventListener("change",ue):t.addListener&&t.addListener(ue))};e(q),e(F)}function Ve(){return!(!_||window.matchMedia?.("(display-mode: standalone)")?.matches||window.navigator?.standalone)}function k(){O&&(O.hidden=!Ve())}function Ue(){if(!O)return;window.addEventListener("beforeinstallprompt",t=>{t.preventDefault(),_=t,k()}),window.addEventListener("appinstalled",()=>{_=null,k()});const e=window.matchMedia?.("(display-mode: standalone)");e?.addEventListener&&e.addEventListener("change",k),O.addEventListener("click",async()=>{_&&(_.prompt(),await _.userChoice,_=null,k())}),k()}function J(e){const t=T[e]?e:"easy";B=t,ee.forEach(r=>{r.classList.toggle("menu__option--active",r.dataset.difficulty===t)})}function je(){const t=ee.find(o=>o.classList.contains("menu__option--active"))?.dataset.difficulty;return{...T[t]||T.easy,symmetric:Math.random()<.33}}function A(e){y=!!e,H.classList.toggle("pad__toggle--active",y),H.setAttribute("aria-checked",y?"true":"false"),Me?.classList.toggle("pad--notes-mode",y),v()}function N(e){const t=!!e;L?.classList.toggle("menu__bubble--open",t),L?.setAttribute("aria-hidden",t?"false":"true"),ge?.setAttribute("aria-expanded",t?"true":"false")}function S(e){const t=!!e;w?.classList.toggle("menu__bubble--open",t),w?.setAttribute("aria-hidden",t?"false":"true"),be?.setAttribute("aria-expanded",t?"true":"false")}function We(e){return{entries:e.entries.map(String).join(""),notes:e.notes.slice()}}function C(){const e={puzzle:b,progress:We(p),history:g,redoHistory:E};localStorage.setItem(Z,JSON.stringify(e))}function He(){const e=localStorage.getItem(Z);if(!e)return!1;try{const t=JSON.parse(e);if(!t?.puzzle?.givens||!t?.puzzle?.solution||!t?.progress)return!1;const r=Ge(t.progress);return r?(b=t.puzzle,B=qe(b.difficulty),p=r,g=Array.isArray(t.history)?t.history.map(de).filter(Boolean):[],E=Array.isArray(t.redoHistory)?t.redoHistory.map(de).filter(Boolean):[],!0):!1}catch{return!1}}function Ge(e){const t=$e(e.entries),r=Array.isArray(e.notes)?e.notes.map(o=>Number(o)||0):null;return!t||!r||r.length!==81?null:{entries:t,notes:r}}function $e(e){return e?Array.isArray(e)?e.length!==81?null:e.map(t=>x(Number(t)||0,0,9)):typeof e=="string"&&e.length===81?e.split("").map(t=>x(Number(t)||0,0,9)):null:null}function qe(e){return T[e]?e:"easy"}function de(e){if(!e||!Number.isInteger(e.idx)||e.idx<0||e.idx>=81)return null;const t=x(Number(e.prevEntry)||0,0,9),r=x(Number(e.nextEntry)||0,0,9),o=Number(e.prevNotes),n=Number(e.nextNotes);return!Number.isInteger(o)||!Number.isInteger(n)?null:{idx:e.idx,prevEntry:t,nextEntry:r,prevNotes:o,nextNotes:n}}function Fe(){V.innerHTML="",Q.cells=[];for(let e=0;e<9;e++)for(let t=0;t<9;t++){const r=Re(e,t),o=document.createElement("div");o.className="board__cell",o.dataset.idx=String(r),o.dataset.r=String(e),o.dataset.c=String(t);const n=document.createElement("div");n.className="board__value";const s=document.createElement("div");s.className="board__notes";for(let i=1;i<=9;i++){const l=document.createElement("div");l.className="board__note",l.dataset.n=String(i),l.textContent=String(i),s.appendChild(l)}o.appendChild(n),o.appendChild(s),V.appendChild(o),Q.cells.push({idx:r,r:e,c:t,root:o,valueEl:n,noteEls:Array.from(s.querySelectorAll(".board__note"))})}ae.innerHTML="";for(let e=1;e<=9;e++){const t=document.createElement("button");t.type="button",t.className="btn btn--pad pad__button",t.dataset.n=String(e),t.textContent=String(e),t.addEventListener("click",()=>fe(e)),ae.appendChild(t)}V.addEventListener("click",e=>{const t=e.target.closest(".board__cell");if(!t)return;const r=Number(t.dataset.idx);if(r===m){A(!y);return}_e(r)}),H.addEventListener("click",()=>A(!y)),Te.addEventListener("click",()=>me()),G.addEventListener("click",()=>pe()),$?.addEventListener("click",()=>j()),ge.addEventListener("click",e=>{e.stopPropagation(),S(!1);const t=L?.classList.contains("menu__bubble--open");N(!t)}),be?.addEventListener("click",e=>{e.stopPropagation(),N(!1);const t=w?.classList.contains("menu__bubble--open");S(!t)}),ze?.addEventListener("click",()=>{te(z==="dark"?"light":"dark")}),ee.forEach(e=>{e.addEventListener("click",t=>{t.stopPropagation();const r=e.dataset.difficulty;J(r),localStorage.removeItem(Z),Le(),N(!1)})}),L?.addEventListener("click",e=>{e.stopPropagation()}),w?.addEventListener("click",e=>{e.stopPropagation()}),Oe.forEach(e=>{e.addEventListener("click",t=>{t.stopPropagation(),S(!1),nt()})}),window.addEventListener("keydown",e=>{if(["INPUT","TEXTAREA","SELECT"].includes(document.activeElement?.tagName))return;const t=e.key,r=navigator.userAgentData?navigator.userAgentData.platform==="macOS":/Mac|iPhone|iPad|iPod/.test(navigator.userAgent),o=t==="z"||t==="Z",n=t==="y"||t==="Y";if(o&&!e.altKey&&(r?e.metaKey:e.ctrlKey)){e.preventDefault(),e.shiftKey?j():pe();return}if(n&&!e.altKey&&!e.shiftKey&&!r&&e.ctrlKey){e.preventDefault(),j();return}if(!(e.metaKey||e.ctrlKey||e.altKey)){if(t>="1"&&t<="9"){e.preventDefault(),fe(Number(t));return}if(t==="Backspace"||t==="Delete"){e.preventDefault(),me();return}if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(t)){e.preventDefault(),et(t);return}if(e.code==="Space"){e.preventDefault(),A(!y);return}}}),document.addEventListener("click",()=>{L?.classList.contains("menu__bubble--open")&&N(!1),w?.classList.contains("menu__bubble--open")&&S(!1)}),document.addEventListener("keydown",e=>{e.key==="Escape"&&(L?.classList.contains("menu__bubble--open")&&N(!1),w?.classList.contains("menu__bubble--open")&&S(!1))})}function Qe(e){return Number(b.givens[e])||p.entries[e]||0}function Ee(e){return Number(b.givens[e])!==0}function Ye(){const e=Array(81).fill(0);for(let t=0;t<81;t++)e[t]=Number(b.givens[t])||p.entries[t]||0;return e}function Je(e){const t=Array.from({length:81},()=>!1);function r(o){const n=new Map;for(const s of o){const i=e[s];i&&(n.has(i)||n.set(i,[]),n.get(i).push(s))}for(const s of n.values())if(s.length>=2)for(const i of s)t[i]=!0}for(let o=0;o<9;o++)r(Array.from({length:9},(n,s)=>o*9+s));for(let o=0;o<9;o++)r(Array.from({length:9},(n,s)=>s*9+o));for(let o=0;o<3;o++)for(let n=0;n<3;n++){const s=[];for(let i=o*3;i<o*3+3;i++)for(let l=n*3;l<n*3+3;l++)s.push(i*9+l);r(s)}return t}function Xe(e){const t=Array.from({length:9},()=>new Set),r=Array.from({length:9},()=>new Set),o=Array.from({length:9},()=>new Set);for(let n=0;n<81;n++){const s=e[n];if(!s)continue;const[i,l]=ye(n);t[i].add(s),r[l].add(s);const a=Math.floor(i/3)*3+Math.floor(l/3);o[a].add(s)}return{rowValues:t,colValues:r,boxValues:o}}function Ze(){for(let e=0;e<81;e++){const t=Number(b.givens[e])||p.entries[e]||0;if(t===0||t!==Number(b.solution[e]))return!1}return!0}function v(){const e=b.givens,t=p.entries,r=p.notes,o=Qe(m),n=Ye(),s=Je(n),{rowValues:i,colValues:l,boxValues:a}=Xe(n);if(U?.classList.toggle("board-shell--completed",Ze()),U){const d=`COMPLETED â€¢ ${B.toUpperCase()}`;U.setAttribute("data-completed-label",d)}Q.cells.forEach(d=>{const{idx:u,root:c,valueEl:h,noteEls:f,r:D,c:R}=d;c.classList.remove("board__cell--selected","board__cell--highlight","board__cell--error","board__cell--has-value","board__cell--notes-active"),h.classList.remove("board__value--given","board__value--entry"),h.textContent="",f.forEach(I=>{I.classList.remove("board__note--filled","board__note--conflict")});const re=Number(e[u]),we=t[u],P=re||we||0;if(P)c.classList.add("board__cell--has-value"),h.textContent=String(P),h.classList.add(re?"board__value--given":"board__value--entry");else{const I=r[u]|0;if(I){const oe=D,se=R,Ae=Math.floor(oe/3)*3+Math.floor(se/3);f.forEach(K=>{const M=Number(K.dataset.n);I&Y(M)&&(K.classList.add("board__note--filled"),(i[oe].has(M)||l[se].has(M)||a[Ae].has(M))&&K.classList.add("board__note--conflict"))})}}!P&&y&&u===m&&c.classList.add("board__cell--notes-active"),u===m&&c.classList.add("board__cell--selected"),o!==0&&P===o&&c.classList.add("board__cell--highlight"),s[u]&&c.classList.add("board__cell--error")}),tt()}function _e(e){m=x(e,0,80),v()}function et(e){const[t,r]=ye(m);let o=t,n=r;e==="ArrowUp"&&(o=(t+8)%9),e==="ArrowDown"&&(o=(t+1)%9),e==="ArrowLeft"&&(n=(r+8)%9),e==="ArrowRight"&&(n=(r+1)%9),m=o*9+n,v()}function fe(e){if(Ee(m))return;const t=p.notes[m]|0;if(y){const s=p.entries[m]!==0?t|Y(e):t^Y(e);X(m,0,s);return}X(m,e,t)}function me(){if(Ee(m))return;const t=p.entries[m]!==0?p.notes[m]|0:0;X(m,0,t)}function X(e,t,r){const o=p.entries[e],n=p.notes[e]|0;o===t&&n===r||(ne(e,t,r),g.push({idx:e,prevEntry:o,prevNotes:n,nextEntry:t,nextNotes:r}),E=[],g.length>De&&g.shift(),C(),v())}function ne(e,t,r){p.entries[e]=t,p.notes[e]=r}function pe(){const e=g.pop();e&&(ne(e.idx,e.prevEntry,e.prevNotes),E.push(e),C(),v())}function j(){const e=E.pop();e&&(ne(e.idx,e.nextEntry,e.nextNotes),g.push(e),C(),v())}function tt(){G&&(G.disabled=g.length===0),$&&($.disabled=E.length===0)}function Le(){b={...Ie(je()),difficulty:B},p={entries:Array(81).fill(0),notes:Array(81).fill(0)},m=0,g=[],E=[],A(!1),C(),v()}function nt(){p={entries:Array(81).fill(0),notes:Array(81).fill(0)},g=[],E=[],m=0,A(!1),C(),v()}function rt(){xe({immediate:!0}),Ke(),te(ve()),Ue(),Fe(),J("easy"),He()?(J(B),A(!1),v()):Le(),_e(0)}rt();

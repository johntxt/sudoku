(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function o(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(n){if(n.ep)return;n.ep=!0;const s=o(n);fetch(n.href,s)}})();const D=e=>{for(let t=e.length-1;t>0;t--){const o=Math.floor(Math.random()*(t+1));[e[t],e[o]]=[e[o],e[t]]}return e},ne=(e,t)=>{if(e[t]!==0)return[];const o=Math.floor(t/9),r=t%9,n=new Set;for(let c=0;c<9;c++)n.add(e[o*9+c]),n.add(e[c*9+r]);const s=Math.floor(o/3)*3,l=Math.floor(r/3)*3;for(let c=s;c<s+3;c++)for(let u=l;u<l+3;u++)n.add(e[c*9+u]);const i=[];for(let c=1;c<=9;c++)n.has(c)||i.push(c);return i},he=e=>{const t=e.slice(),o=()=>{let n=-1,s=null;for(let l=0;l<81;l++)if(t[l]===0){const i=ne(t,l);if(i.length===0)return{idx:l,cand:[]};if((!s||i.length<s.length)&&(s=i,n=l,i.length===1))break}return{idx:n,cand:s}},r=()=>{const{idx:n,cand:s}=o();if(n===-1)return!0;if(s.length===0)return!1;D(s);for(const l of s){if(t[n]=l,r())return!0;t[n]=0}return!1};return r()?t:null},be=(e,t=2)=>{const o=e.slice();let r=0;const n=()=>{let l=-1,i=null;for(let c=0;c<81;c++)if(o[c]===0){const u=ne(o,c);if(u.length===0)return{idx:c,cand:[]};if((!i||u.length<i.length)&&(i=u,l=c,u.length===1))break}return{idx:l,cand:i}},s=()=>{if(r>=t)return;const{idx:l,cand:i}=n();if(l===-1){r++;return}if(i.length!==0){for(const c of i)if(o[l]=c,s(),o[l]=0,r>=t)return}};return s(),r},ye=()=>he(Array(81).fill(0)),X=e=>e.map(t=>String(t)).join(""),ve=({minClues:e=32,maxClues:t=36,symmetric:o=!0}={})=>{const r=ye();if(!r)throw new Error("Failed to generate solution");const n=r.slice(),s=Array.from({length:81},(a,f)=>f);D(s);const l=e+Math.floor(Math.random()*(t-e+1));let i=81;const c=new Set,u=[];for(const a of s){if(c.has(a))continue;if(!o){c.add(a),u.push([a]);continue}const f=80-a;c.add(a),c.add(f),u.push(a===f?[a]:[a,f])}D(u);for(const a of u){if(i<=l)break;const f=a.filter(p=>n[p]!==0).length;if(f===0||i-f<l)continue;const v=a.map(p=>n[p]);for(const p of a)n[p]=0;if(be(n,2)!==1)for(let p=0;p<a.length;p++)n[a[p]]=v[p];else i-=f}return{givens:X(n),solution:X(r)}},H="sudoku_v1",z=document.getElementById("board"),Z=document.getElementById("pad"),_e=document.getElementById("padContainer"),T=document.getElementById("boardWrap"),re=document.getElementById("newPuzzle"),oe=document.getElementById("resetPuzzle"),Ee=document.getElementById("themeToggle"),_=document.getElementById("difficultyBubble"),E=document.getElementById("resetBubble"),F=Array.from(document.querySelectorAll("[data-difficulty]")),Le=Array.from(document.querySelectorAll("[data-reset]")),C=document.getElementById("noteSwitch"),Ae=document.getElementById("eraseBtn"),O=document.getElementById("undoBtn");let g=null,d=null,m=0,b=!1,K="light",V=null,U=null,h=[],S="easy";const R={cells:[]},Ne=500,B={easy:{minClues:35,maxClues:40},medium:{minClues:30,maxClues:35},hard:{minClues:25,maxClues:30}},ke=(e,t)=>e*9+t,se=e=>[Math.floor(e/9),e%9],le=e=>1<<e-1,x=(e,t,o)=>Math.max(t,Math.min(o,e));function J(e){K=e==="dark"?"dark":"light",document.documentElement.setAttribute("data-theme",K)}function ie(){return V?.matches?"dark":(U?.matches,"light")}function $(){J(ie())}function xe(){if(!window.matchMedia)return;V=window.matchMedia("(prefers-color-scheme: dark)"),U=window.matchMedia("(prefers-color-scheme: light)");const e=t=>{t&&(t.addEventListener?t.addEventListener("change",$):t.addListener&&t.addListener($))};e(V),e(U)}function j(e){const t=B[e]?e:"easy";S=t,F.forEach(o=>{o.classList.toggle("menu__option--active",o.dataset.difficulty===t)})}function Se(){const t=F.find(r=>r.classList.contains("menu__option--active"))?.dataset.difficulty;return{...B[t]||B.easy,symmetric:Math.random()<.33}}function L(e){b=!!e,C.classList.toggle("pad__toggle--active",b),C.setAttribute("aria-checked",b?"true":"false"),_e?.classList.toggle("pad--notes-mode",b)}function N(e){const t=!!e;_?.classList.toggle("menu__bubble--open",t),_?.setAttribute("aria-hidden",t?"false":"true"),re?.setAttribute("aria-expanded",t?"true":"false")}function k(e){const t=!!e;E?.classList.toggle("menu__bubble--open",t),E?.setAttribute("aria-hidden",t?"false":"true"),oe?.setAttribute("aria-expanded",t?"true":"false")}function we(e){return{entries:e.entries.map(String).join(""),notes:e.notes.slice()}}function I(){const e={puzzle:g,progress:we(d),history:h};localStorage.setItem(H,JSON.stringify(e))}function Ce(){const e=localStorage.getItem(H);if(!e)return!1;try{const t=JSON.parse(e);if(!t?.puzzle?.givens||!t?.puzzle?.solution||!t?.progress)return!1;const o=Be(t.progress);return o?(g=t.puzzle,S=Me(g.difficulty),d=o,h=Array.isArray(t.history)?t.history.map(Pe).filter(Boolean):[],!0):!1}catch{return!1}}function Be(e){const t=Ie(e.entries),o=Array.isArray(e.notes)?e.notes.map(r=>Number(r)||0):null;return!t||!o||o.length!==81?null:{entries:t,notes:o}}function Ie(e){return e?Array.isArray(e)?e.length!==81?null:e.map(t=>x(Number(t)||0,0,9)):typeof e=="string"&&e.length===81?e.split("").map(t=>x(Number(t)||0,0,9)):null:null}function Me(e){return B[e]?e:"easy"}function Pe(e){if(!e||!Number.isInteger(e.idx)||e.idx<0||e.idx>=81)return null;const t=x(Number(e.prevEntry)||0,0,9),o=x(Number(e.nextEntry)||0,0,9),r=Number(e.prevNotes),n=Number(e.nextNotes);return!Number.isInteger(r)||!Number.isInteger(n)?null:{idx:e.idx,prevEntry:t,nextEntry:o,prevNotes:r,nextNotes:n}}function ze(){z.innerHTML="",R.cells=[];for(let e=0;e<9;e++)for(let t=0;t<9;t++){const o=ke(e,t),r=document.createElement("div");r.className="board__cell",r.dataset.idx=String(o),r.dataset.r=String(e),r.dataset.c=String(t);const n=document.createElement("div");n.className="board__value";const s=document.createElement("div");s.className="board__notes";for(let l=1;l<=9;l++){const i=document.createElement("div");i.className="board__note",i.dataset.n=String(l),i.textContent=String(l),s.appendChild(i)}r.appendChild(n),r.appendChild(s),z.appendChild(r),R.cells.push({idx:o,r:e,c:t,root:r,valueEl:n,noteEls:Array.from(s.querySelectorAll(".board__note"))})}Z.innerHTML="";for(let e=1;e<=9;e++){const t=document.createElement("button");t.type="button",t.className="btn btn--pad pad__button",t.dataset.n=String(e),t.textContent=String(e),t.addEventListener("click",()=>q(e)),Z.appendChild(t)}z.addEventListener("click",e=>{const t=e.target.closest(".board__cell");t&&ae(Number(t.dataset.idx))}),C.addEventListener("click",()=>L(!b)),C.addEventListener("keydown",e=>{(e.key==="Enter"||e.key===" ")&&(e.preventDefault(),L(!b))}),Ae.addEventListener("click",()=>ee()),O.addEventListener("click",()=>te()),re.addEventListener("click",e=>{e.stopPropagation(),k(!1);const t=_?.classList.contains("menu__bubble--open");N(!t)}),oe?.addEventListener("click",e=>{e.stopPropagation(),N(!1);const t=E?.classList.contains("menu__bubble--open");k(!t)}),Ee?.addEventListener("click",()=>{J(K==="dark"?"light":"dark")}),F.forEach(e=>{e.addEventListener("click",t=>{t.stopPropagation();const o=e.dataset.difficulty;j(o),localStorage.removeItem(H),de(),N(!1)})}),_?.addEventListener("click",e=>{e.stopPropagation()}),E?.addEventListener("click",e=>{e.stopPropagation()}),Le.forEach(e=>{e.addEventListener("click",t=>{t.stopPropagation(),k(!1),je()})}),window.addEventListener("keydown",e=>{if(["INPUT","TEXTAREA","SELECT"].includes(document.activeElement?.tagName))return;const t=e.key,o=navigator.userAgentData?navigator.userAgentData.platform==="macOS":/Mac|iPhone|iPad|iPod/.test(navigator.userAgent);if((t==="z"||t==="Z")&&!e.altKey&&!e.shiftKey&&(o?e.metaKey:e.ctrlKey)){e.preventDefault(),te();return}if(!(e.metaKey||e.ctrlKey||e.altKey)){if(t>="1"&&t<="9"){e.preventDefault(),q(Number(t));return}if(t==="Backspace"||t==="Delete"){e.preventDefault(),ee();return}if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(t)){e.preventDefault(),Ue(t);return}if(e.code==="Space"){e.preventDefault(),L(!b);return}}}),document.addEventListener("click",()=>{_?.classList.contains("menu__bubble--open")&&N(!1),E?.classList.contains("menu__bubble--open")&&k(!1)}),document.addEventListener("keydown",e=>{e.key==="Escape"&&(_?.classList.contains("menu__bubble--open")&&N(!1),E?.classList.contains("menu__bubble--open")&&k(!1))})}function Te(e){return Number(g.givens[e])||d.entries[e]||0}function ce(e){return Number(g.givens[e])!==0}function De(){const e=Array(81).fill(0);for(let t=0;t<81;t++)e[t]=Number(g.givens[t])||d.entries[t]||0;return e}function Oe(e){const t=Array.from({length:81},()=>!1);function o(r){const n=new Map;for(const s of r){const l=e[s];l&&(n.has(l)||n.set(l,[]),n.get(l).push(s))}for(const s of n.values())if(s.length>=2)for(const l of s)t[l]=!0}for(let r=0;r<9;r++)o(Array.from({length:9},(n,s)=>r*9+s));for(let r=0;r<9;r++)o(Array.from({length:9},(n,s)=>s*9+r));for(let r=0;r<3;r++)for(let n=0;n<3;n++){const s=[];for(let l=r*3;l<r*3+3;l++)for(let i=n*3;i<n*3+3;i++)s.push(l*9+i);o(s)}return t}function Ke(e){const t=Array.from({length:9},()=>new Set),o=Array.from({length:9},()=>new Set),r=Array.from({length:9},()=>new Set);for(let n=0;n<81;n++){const s=e[n];if(!s)continue;const[l,i]=se(n);t[l].add(s),o[i].add(s);const c=Math.floor(l/3)*3+Math.floor(i/3);r[c].add(s)}return{rowValues:t,colValues:o,boxValues:r}}function Ve(){for(let e=0;e<81;e++){const t=Number(g.givens[e])||d.entries[e]||0;if(t===0||t!==Number(g.solution[e]))return!1}return!0}function y(){const e=g.givens,t=d.entries,o=d.notes,r=Te(m),n=De(),s=Oe(n),{rowValues:l,colValues:i,boxValues:c}=Ke(n);if(T?.classList.toggle("board-shell--completed",Ve()),T){const u=`COMPLETED â€¢ ${S.toUpperCase()}`;T.setAttribute("data-completed-label",u)}R.cells.forEach(u=>{const{idx:a,root:f,valueEl:v,noteEls:p,r:fe,c:me}=u;f.classList.remove("board__cell--selected","board__cell--highlight","board__cell--error","board__cell--has-value"),v.classList.remove("board__value--given","board__value--entry"),v.textContent="",p.forEach(A=>{A.style.opacity="0",A.classList.remove("board__note--conflict")});const Q=Number(e[a]),pe=t[a],M=Q||pe||0;if(M)f.classList.add("board__cell--has-value"),v.textContent=String(M),v.classList.add(Q?"board__value--given":"board__value--entry");else{const A=o[a]|0;if(A){const W=fe,Y=me,ge=Math.floor(W/3)*3+Math.floor(Y/3);p.forEach(P=>{const w=Number(P.dataset.n);A&le(w)&&(P.style.opacity="0.85",(l[W].has(w)||i[Y].has(w)||c[ge].has(w))&&P.classList.add("board__note--conflict"))})}}a===m&&f.classList.add("board__cell--selected"),r!==0&&M===r&&f.classList.add("board__cell--highlight"),s[a]&&f.classList.add("board__cell--error")}),Re()}function ae(e){m=x(e,0,80),y()}function Ue(e){const[t,o]=se(m);let r=t,n=o;e==="ArrowUp"&&(r=(t+8)%9),e==="ArrowDown"&&(r=(t+1)%9),e==="ArrowLeft"&&(n=(o+8)%9),e==="ArrowRight"&&(n=(o+1)%9),m=r*9+n,y()}function q(e){if(ce(m))return;const t=d.notes[m]|0;if(b){const n=t^le(e)|0;G(m,0,n);return}G(m,e,t)}function ee(){if(ce(m))return;const t=d.entries[m]!==0?d.notes[m]|0:0;G(m,0,t)}function G(e,t,o){const r=d.entries[e],n=d.notes[e]|0;r===t&&n===o||(ue(e,t,o),h.push({idx:e,prevEntry:r,prevNotes:n,nextEntry:t,nextNotes:o}),h.length>Ne&&h.shift(),I(),y())}function ue(e,t,o){d.entries[e]=t,d.notes[e]=o}function te(){const e=h.pop();e&&(ue(e.idx,e.prevEntry,e.prevNotes),I(),y())}function Re(){O&&(O.disabled=h.length===0)}function de(){g={...ve(Se()),difficulty:S},d={entries:Array(81).fill(0),notes:Array(81).fill(0)},m=0,h=[],L(!1),I(),y()}function je(){d={entries:Array(81).fill(0),notes:Array(81).fill(0)},h=[],m=0,L(!1),I(),y()}function Ge(){xe(),J(ie()),ze(),j("easy"),Ce()?(j(S),L(!1),y()):de(),ae(0)}Ge();
